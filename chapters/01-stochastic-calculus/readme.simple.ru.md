# Стохастическое исчисление: объяснение простыми словами

## Что это вообще такое?

Представь, что ты наблюдаешь за пьяным человеком, который пытается идти домой. Он делает шаг, но не знает точно куда — то влево, то вправо, случайным образом. Это называется **случайное блуждание**.

А теперь представь, что этот человек делает шаги настолько маленькие и быстрые, что его движение становится непрерывным — как будто он плывёт по случайной траектории. Это и есть **броуновское движение**!

---

## Почему это важно для трейдинга?

Цена акции или криптовалюты ведёт себя похоже на пьяного человека:
- Мы не знаем, куда она пойдёт в следующий момент
- Но мы можем описать вероятности разных исходов
- И использовать это для принятия решений

---

## Броуновское движение: история из жизни

### Пыльца в воде

В 1827 году ботаник Роберт Браун смотрел в микроскоп на пыльцу в воде. Он увидел, что крошечные частички пыльцы постоянно дёргаются в случайных направлениях.

**Почему?** Потому что миллионы невидимых молекул воды постоянно толкают частичку пыльцы со всех сторон. Каждый толчок — случайный, и результат — хаотическое движение.

### Аналогия для понимания

Представь себе **футбольный мяч на стадионе**, где тысячи болельщиков одновременно бросают в него теннисные мячики со всех сторон. Мяч будет двигаться хаотично, потому что удары приходят случайным образом.

Так же и цена акции: тысячи трейдеров покупают и продают, толкая цену вверх и вниз.

---

## Главные свойства броуновского движения

### 1. Старт с нуля

Начинаем считать с нуля: $W_0 = 0$.

**Аналогия**: Ты стоишь на месте перед тем, как начать случайное блуждание.

### 2. Непрерывность

Траектория непрерывная — нет "телепортаций" из одной точки в другую.

**Аналогия**: Как ниточка, которую тянут — она не рвётся, а плавно изгибается.

### 3. Независимые приращения

То, куда пойдёт цена в следующую секунду, не зависит от того, куда она шла до этого.

**Аналогия**: Когда ты подбрасываешь монетку, результат не зависит от предыдущих бросков. Каждый раз — новая случайность.

### 4. Нормальное распределение

Если подождать время $t$, то изменение $W_t$ будет распределено "колоколом" (нормально) с разбросом $\sqrt{t}$.

**Аналогия**: Если много раз бросить кубик и сложить результаты — получится колокол. Чем больше бросков, тем шире колокол.

---

## Интеграл Ито: зачем он нужен?

### Проблема

В обычной математике, если знаешь скорость изменения чего-то, можно найти само значение через интеграл.

Но броуновское движение **не имеет скорости**! Оно слишком "дёрганое" — траектория никогда не гладкая.

### Решение Ито

Японский математик Ито придумал специальный способ интегрирования, который работает для случайных процессов.

**Аналогия с банком**:

Представь, что ты кладёшь деньги в банк под процент, который меняется случайным образом каждую секунду.
- Обычный интеграл не работает, потому что процент "скачет"
- Интеграл Ито говорит: "Используй процент, который был в **начале** каждого маленького периода"

Это как если бы банк говорил: "Мы начислим тебе проценты по ставке, которая была в начале дня, даже если потом она изменилась".

---

## Лемма Ито: "цепное правило" для случайности

### Обычное цепное правило

В школьной математике, если $y = x^2$ и $x$ меняется, то:
$$\frac{dy}{dx} = 2x$$

### Проблема со случайностью

Но если $x$ — это броуновское движение, появляется **дополнительный член**!

### Формула Ито

Если $f(W_t)$ — функция от броуновского движения, то:

$$df = f'(W_t) \cdot dW_t + \frac{1}{2} f''(W_t) \cdot dt$$

**Откуда берётся дополнительный член?**

Потому что $(dW)^2 = dt$, а не ноль!

### Аналогия

Представь, что ты едешь на велосипеде по очень неровной дороге (броуновское движение).
- На гладкой дороге ты бы просто ехал
- Но на кочках ты постоянно подпрыгиваешь, и это добавляет "лишнее" расстояние

Этот "эффект кочек" — это и есть дополнительный член в формуле Ито.

---

## Модели цен

### Геометрическое броуновское движение (GBM)

**Формула**:
$$dS_t = \mu S_t \, dt + \sigma S_t \, dW_t$$

**Что это значит простыми словами?**

- $S_t$ — цена акции
- $\mu$ — "тренд": куда цена склонна идти в среднем (вверх или вниз)
- $\sigma$ — "размах" случайных колебаний (волатильность)
- $dW_t$ — случайный "толчок"

**Аналогия — воздушный шар**:

Представь воздушный шар, который:
- В среднем поднимается вверх (тренд $\mu > 0$)
- Но ветер постоянно сносит его то влево, то вправо ($\sigma \cdot dW$)

Чем сильнее ветер ($\sigma$), тем менее предсказуема траектория.

### Почему умножаем на $S_t$?

Потому что цена акции не может стать отрицательной!

Если $S_t = 100$ и волатильность 20%, то колебания порядка $\pm 20$.
Если $S_t = 10$, то колебания порядка $\pm 2$.

**Аналогия**: Богатый человек может потерять больше денег в абсолютном выражении, но оба теряют одинаковый **процент**.

---

## Стохастическая волатильность (модель Хестона)

### Проблема с GBM

В реальности волатильность не постоянная! Иногда рынок спокойный, иногда бурлит.

### Решение Хестона

Пусть и волатильность тоже меняется случайно:

$$dS_t = \mu S_t \, dt + \sqrt{V_t} S_t \, dW^S_t$$
$$dV_t = \kappa(\theta - V_t) \, dt + \xi \sqrt{V_t} \, dW^V_t$$

**Что это значит?**

- $V_t$ — текущая волатильность (она случайная!)
- $\theta$ — "нормальный" уровень волатильности
- $\kappa$ — как быстро волатильность возвращается к норме
- $\xi$ — насколько сильно прыгает сама волатильность

**Аналогия — погода**:

- Температура ($S$) меняется случайно
- Но и "изменчивость погоды" ($V$) тоже меняется!
- Летом погода более стабильная, зимой — более переменчивая
- Со временем погода возвращается к "нормальной" изменчивости

---

## Скачки (Jump-Diffusion)

### Проблема

GBM предполагает, что цена меняется плавно. Но иногда бывают резкие скачки — хорошие новости, плохие новости, обвалы.

### Решение Мертона

Добавим случайные скачки:

$$dS_t = \mu S_t \, dt + \sigma S_t \, dW_t + S_t \, dJ_t$$

где $J_t$ — процесс скачков.

**Аналогия — пешеход и автобус**:

Представь, что ты идёшь пешком (обычное движение) и иногда запрыгиваешь в автобус (скачок). Автобус может везти тебя вперёд или назад, и ты не знаешь, когда он появится.

---

## Monte Carlo: когда формулы не помогают

### Идея

Если невозможно вычислить что-то по формуле, можно **симулировать** много случайных траекторий и посмотреть, что получается в среднем.

**Аналогия — эксперимент**:

Чтобы узнать вероятность выиграть в настольную игру, можно:
1. Вывести формулу (сложно!)
2. Или сыграть 10000 игр и посчитать, сколько раз выиграл

### Пример на Rust

```rust
// Представим, что мы хотим узнать среднюю цену акции через год
// Начальная цена = 100, рост = 10%, волатильность = 20%

use rand::Rng;
use rand_distr::{Normal, Distribution};

fn simulate_price(s0: f64, mu: f64, sigma: f64, t: f64) -> f64 {
    let mut rng = rand::thread_rng();
    let normal = Normal::new(0.0, 1.0).unwrap();

    // Случайное число из нормального распределения
    let z = normal.sample(&mut rng);

    // Формула GBM (точное решение)
    s0 * ((mu - 0.5 * sigma * sigma) * t + sigma * t.sqrt() * z).exp()
}

fn main() {
    let s0 = 100.0;      // Начальная цена
    let mu = 0.10;       // 10% годовой рост
    let sigma = 0.20;    // 20% волатильность
    let t = 1.0;         // 1 год

    let n_simulations = 100_000;

    // Симулируем много траекторий
    let sum: f64 = (0..n_simulations)
        .map(|_| simulate_price(s0, mu, sigma, t))
        .sum();

    let average = sum / n_simulations as f64;

    println!("Средняя цена через год: {:.2}", average);
    // Ожидаем около 110.52 (= 100 * e^0.10)
}
```

---

## Практический пример: симуляция цены Bitcoin

```rust
use rand::Rng;
use rand_distr::{Normal, Distribution};

/// Генерирует траекторию цены с прыжками
fn simulate_bitcoin_path(
    initial_price: f64,
    days: usize,
) -> Vec<f64> {
    let mut rng = rand::thread_rng();
    let normal = Normal::new(0.0, 1.0).unwrap();

    // Параметры Bitcoin (примерные)
    let mu = 0.5;        // 50% годовой рост (исторически)
    let sigma = 0.8;     // 80% волатильность (очень высокая!)
    let dt = 1.0 / 365.0; // Один день

    let mut prices = Vec::with_capacity(days + 1);
    prices.push(initial_price);

    let mut price = initial_price;

    for _ in 0..days {
        let z = normal.sample(&mut rng);

        // Дневное изменение
        let daily_return = (mu - 0.5 * sigma * sigma) * dt
                          + sigma * dt.sqrt() * z;

        price *= daily_return.exp();
        prices.push(price);
    }

    prices
}

fn main() {
    let btc_price = 50_000.0; // Начальная цена $50,000
    let days = 365;           // Симулируем год

    // Генерируем несколько траекторий
    for i in 1..=5 {
        let path = simulate_bitcoin_path(btc_price, days);
        let final_price = path.last().unwrap();

        println!("Траектория {}: ${:.0} -> ${:.0} ({:+.1}%)",
            i,
            btc_price,
            final_price,
            (final_price / btc_price - 1.0) * 100.0
        );
    }
}
```

**Пример вывода**:
```
Траектория 1: $50000 -> $127543 (+155.1%)
Траектория 2: $50000 -> $23891 (-52.2%)
Траектория 3: $50000 -> $89234 (+78.5%)
Траектория 4: $50000 -> $41023 (-18.0%)
Траектория 5: $50000 -> $234521 (+369.0%)
```

Видишь, какой разброс! Это и есть высокая волатильность криптовалют.

---

## Ключевые термины (шпаргалка)

| Термин | Простое объяснение |
|--------|-------------------|
| **Броуновское движение** | Случайное блуждание в непрерывном времени |
| **Волатильность (σ)** | Насколько сильно скачет цена |
| **Дрейф (μ)** | Куда цена склонна идти в среднем |
| **Интеграл Ито** | Способ суммировать случайные изменения |
| **Лемма Ито** | Правило для функций от случайных процессов |
| **Monte Carlo** | Метод оценки через много симуляций |
| **GBM** | Основная модель для цен активов |
| **Стохастическая волатильность** | Когда сама волатильность случайна |

---

## Зачем всё это трейдеру?

1. **Оценка рисков**: Сколько я могу потерять с вероятностью 95%?
2. **Ценообразование опционов**: Сколько стоит право купить акцию через месяц?
3. **Создание стратегий**: Как торговать, учитывая случайность?
4. **Бэктестинг**: Симулировать тысячи сценариев, чтобы проверить стратегию

---

## Что дальше?

В следующей главе мы изучим **микроструктуру рынка**:
- Как работает книга заявок (order book)
- Почему цена "прыгает" между bid и ask
- Как зарабатывают маркет-мейкеры

Понимание стохастического исчисления поможет тебе понять, как моделировать поток заявок и принимать решения в реальном времени!
